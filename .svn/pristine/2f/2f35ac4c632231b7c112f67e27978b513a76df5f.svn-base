Imports System.Text
''' <summary>
''' 生成每一个工具的引用文献的工具
''' </summary>
Module Cite

    Public Sub GenerateDocument(repository As String, library As Scripting.ShoalShell.SPM.PackageModuleDb)
        Dim index As New StringBuilder(My.Resources.index)
        Call index.Replace(Title, "Cites")
        Call index.Replace(Doc, __innerHTML(library))
        Call index.SaveTo($"{repository}/cites.html", System.Text.Encoding.UTF8)
    End Sub

    Private Function __innerHTML(library As Scripting.ShoalShell.SPM.PackageModuleDb) As String
        Dim html As New StringBuilder("Here is a list of articles that cite for build the modules in the GCModeller, many thanks to these researches:")
        Dim LQuery = (From ns In library.NamespaceCollection
                      Select (From x In ns.PartialModules
                              Where Not String.IsNullOrEmpty(x.Cites)
                              Select x.Cites).ToArray).MatrixToList
        Call html.AppendLine("<br /><br />")
        Call html.AppendLine("<table><tr><td>References</td></tr>")
        Call html.AppendLine(LQuery.ToArray(Function(x, i) $"<tr><td>{x.InvokeReplace("<", "&lt;")}</td></tr>").JoinBy(vbCrLf))
        Call html.AppendLine("</table>")

        Return html.ToString
    End Function
End Module
