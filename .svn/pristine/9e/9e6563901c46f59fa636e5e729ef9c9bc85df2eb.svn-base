Imports Microsoft.VisualBasic.CommandLine.Reflection
Imports ShoalShell.Plugins.HtmlHelpServer.Bend.Util
Imports System.Threading
Imports Microsoft.VisualBasic.Parallel

<[Namespace]("Wiki.Http_Server", description:="Running the shoal shell local HTTP server for served the help information about the shoal shell system.")>
Public Module HelpServer

    Dim _serverEngine As ShoalShell.Plugins.HtmlHelpServer.NotificationIcon

    <ExportAPI("_start()")>
    Public Function StartServer() As Integer
        Call (Sub() NotificationIcon.Main(Nothing)).BeginInvoke(Nothing, Nothing)
        Return 0
    End Function

    Friend Function __runServer(Optional LocalPort As Integer = 8080) As Thread
        Dim HttpServer As Bend.Util.HttpServer = New ShoalHttpServer(LocalPort)
        Dim svrThread = Run(AddressOf HttpServer.Run)
        Call Thread.Sleep(1000)
        Call Process.Start("http://127.0.0.1:8080")
        Return svrThread
    End Function
End Module
